<?php

/**
 * @file
 * @todo.
 */

/**
 * Implements hook_perm().
 *
 * Defines permissions available related to the facebook widget functionalities.
 */
function fb_likebox_perm() {
  return array('admin facebook likebox settings');
}

/**
 * Implements hook_menu().
 */
function fb_likebox_menu() {
  $items['admin/settings/fb-likebox'] = array(
    'title' => 'Facebook Likebox Settings',
    'description' => 'Configure Facebook Likebox parameters',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('fb_likebox_admin_settings'),
    'access arguments' => array('admin facebook likebox settings'),
    'type' => MENU_NORMAL_ITEM,
    'file' => 'fb_likebox.admin.inc',
  );
  return $items;
}

/**
 * Implements hook_block().
 */
function fb_likebox_block($op = 'list', $delta = 0, $edit = array()) {
  switch ($op) {
    case 'list':
      $site_name = variable_get('site_name', 'Default site name');
      $blocks[0]['info'] = check_plain($site_name . ' ' . t('on Facebook'));
      // We set not to get a cache of this block.
      $blocks[0]['cache'] = BLOCK_NO_CACHE;
      return $blocks;

    case 'view':
      switch ($delta) {
        case 0:
          // Get the values given in the admin form.
          $fb_url = check_url(variable_get('fb_likebox_url', 'http://www.facebook.com/wikisaber.es'));
          $fb_colorscheme = check_plain(variable_get('fb_likebox_colorscheme', 'light'));
          $fb_header = check_plain(variable_get('fb_likebox_header', 'true'));
          $fb_stream = check_plain(variable_get('fb_likebox_stream', 'true'));
          $fb_show_faces = check_plain(variable_get('fb_likebox_show_faces', 'true'));
          $fb_scrolling = check_plain(variable_get('fb_likebox_scrolling', 'no'));
          $fb_width = check_plain(variable_get('fb_likebox_width', '292'));
          $fb_height = check_plain(variable_get('fb_likebox_height', '556'));

          // Set the subject of the block (title to be displayed to the users).
          $site_name = variable_get('site_name', 'Default site name');
          $blocks[0]['info'] = check_plain($site_name . ' ' . t('on Facebook'));

          // Call to the theming function.
          $block['content'] = theme('fb_likebox_facebook', $fb_url, $fb_colorscheme, $fb_header, $fb_stream, $fb_show_faces, $fb_scrolling, $fb_width, $fb_height);
          return $block;
      }
      break;
  }
}

/**
 * Implements hook_theme().
 */
function fb_likebox_theme($existing, $type, $theme, $path) {
  return array(
    'fb_likebox_facebook' => array(
      'arguments' => array(
        'fb_url' => NULL,
        'fb_colorscheme' => NULL,
        'fb_header' => NULL,
        'fb_stream' => NULL,
        'fb_show_faces' => NULL,
        'fb_scrolling' => NULL,
        'fb_width' => NULL,
        'fb_height' => NULL,
      ),
      'path' => $path . '/templates',
      'template' => 'fb_likebox',
    ),
  );
}
